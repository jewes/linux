# Load and CPU Usage
关注系统是否繁忙的时候，我们通常会关注两个指标，一个是CPU的利用率，还有一个是系统Load。

## 什么是Load？
Load表示系统中正在使用CPU和等待使用CPU的进程数。Load是一个动态变化的值，因此通常是关注过去1分钟，5分钟和15分钟的系统的平均Load。

很自然的一个问题，系统的Load多少比较合适呢？这取决于系统有多少个核。平均Load小于或者等于CPU的核数（或者稍微多一点）是一个比较正常的值。当平均load大于CPU的核数时，这说明有任务在等待CPU资源，系统有些繁忙了。如果是在线服务的话，响应时间可能就会变长了。

那怎么看系统的load呢？在Linux下可以用uptime或者top命令来看系统的平均load。

## Load和CPU利用率有什么关系？
Load反映的是系统负载的综合指标，而CPU利用率是一个更加细化的指标。在网上看到一个以电话亭为例子来讲解这个问题。

假设有4个电话亭，每个人可以使用1分钟，1分钟以后不管有没有使用完都必须停止，让下一个人使用，这就类似于CPU的时间分片。

场景一：现在有4个人正在使用电话厅，那么系统的load就是4，这时系统Load正常。如果有4个人正在使用电话厅，还有2个人在外面排队，这时系统的Load就是6。

场景二：假如正在使用电话亭的人在分配给他的1分钟时间内，一直在通话，这时电话亭的利用率是100%。那如果那1分钟内，花了30秒的时间来找电话号码和拨号，剩下30秒的时间才用来通话，那么电话亭的利用率为50%。这类似于CPU在等待IO，虽然Load高，但是CPU的利用率不高。

## 如何找出Java应用中耗CPU的线程
在Linux，Java的线程也对应到系统的一个进程。首先，用top -H(-H表示查看线程)找出系统耗CPU的线程，记录下其pid。这个pid是10进制的，先需要换算成16进制。然后用jstack打印出Java应用的堆栈信息，在里面查找那个16进制的进程号，这样就可以知道Java中哪个线程耗CPU了，并且也知道其stack trace。
